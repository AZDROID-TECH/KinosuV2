import{$,a0 as D,j as e,a as V,r as s,T as W,I,g as q,B,C as T,a6 as R,a7 as Me,a8 as Ee,aa as Ie,v as z,L as Re,c as w,i as Te,s as Ue,u as Pe,a3 as H,P as Le,a4 as we,ae as Ae,d as he}from"./index-CrmpAmly.js";import{d as ce}from"./Person-CXxvfRlk.js";import{d as Oe}from"./Delete-Cpi1zcdc.js";import{f as We}from"./movieHelpers-DztUmcMh.js";import{d as He}from"./OpenInNew-55n4TrFm.js";import{d as Be}from"./Movie-DhY2fVyV.js";import{d as Ve}from"./CheckCircle-sO-Rh5Bt.js";import{d as qe}from"./Cancel-BE4bN6YC.js";import{g as Ne,f as Fe,l as Qe,d as Ye}from"./commentService-FKom3GiN.js";import{C as Ge}from"./ConfirmationDialog-D49oLqPr.js";import{D as X,a as J,b as K}from"./DialogTitle-DkPRNJ0Q.js";import{L as Xe}from"./Link-BRZa2Zyc.js";import{D as Z}from"./DialogActions-BA7wUD1a.js";import{C as Y}from"./Chip-BKNawDy3.js";import{T as Je,a as Ke,b as Ze,c as me,d as n,e as et}from"./TableRow-0iQMZ8RC.js";import{S as fe}from"./Stack-DIm0lD5b.js";import{T as xe}from"./TextField-BEzaClqi.js";import{D as tt}from"./DialogContentText-n3bNbVOI.js";var ee={},it=$;Object.defineProperty(ee,"__esModule",{value:!0});var G=ee.default=void 0,st=it(D()),ue=e;G=ee.default=(0,st.default)([(0,ue.jsx)("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),(0,ue.jsx)("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings");var te={},at=$;Object.defineProperty(te,"__esModule",{value:!0});var pe=te.default=void 0,rt=at(D()),lt=e;pe=te.default=(0,rt.default)((0,lt.jsx)("path",{d:"m22.27 21.73-3.54-3.55L5.78 5.23 2.27 1.72 1 2.99 3.01 5H3v6c0 5.55 3.84 10.74 9 12 2.16-.53 4.08-1.76 5.6-3.41L21 23zM13 9.92l6.67 6.67C20.51 14.87 21 12.96 21 11V5l-9-4-5.48 2.44L11 7.92z"}),"RemoveModerator");var ie={},nt=$;Object.defineProperty(ie,"__esModule",{value:!0});var je=ie.default=void 0,ot=nt(D()),dt=e;je=ie.default=(0,ot.default)((0,dt.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");var se={},ct=$;Object.defineProperty(se,"__esModule",{value:!0});var ae=se.default=void 0,mt=ct(D()),xt=e;ae=se.default=(0,mt.default)((0,xt.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H6l-2 2V4h16z"}),"ChatBubbleOutline");var re={},ut=$;Object.defineProperty(re,"__esModule",{value:!0});var ve=re.default=void 0,ht=ut(D()),ft=e;ve=re.default=(0,ht.default)((0,ft.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var le={},pt=$;Object.defineProperty(le,"__esModule",{value:!0});var ge=le.default=void 0,jt=pt(D()),vt=e;ge=le.default=(0,jt.default)((0,vt.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline");var ne={},gt=$;Object.defineProperty(ne,"__esModule",{value:!0});var be=ne.default=void 0,bt=gt(D()),yt=e;be=ne.default=(0,bt.default)((0,yt.jsx)("path",{d:"M17 10H7v2h10zm2-7h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V8h14zm-5-5H7v2h7z"}),"EventNote");var oe={},_t=$;Object.defineProperty(oe,"__esModule",{value:!0});var ye=oe.default=void 0,St=_t(D()),Ct=e;ye=oe.default=(0,St.default)((0,Ct.jsx)("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"}),"HourglassEmpty");const zt={pending:{label:"Gözləmədə",icon:e.jsx(ye,{fontSize:"small"}),color:"warning"},approved:{label:"Təsdiqlənmiş",icon:e.jsx(Ve,{fontSize:"small"}),color:"success"},rejected:{label:"İptal edildi",icon:e.jsx(qe,{fontSize:"small"}),color:"error"}},$t=({open:u,onClose:a,userId:o,username:p})=>{const r=V(),[c,m]=s.useState([]),[d,y]=s.useState(!1),[_,k]=s.useState(null),[S,j]=s.useState(null),[v,U]=s.useState(!1),[l,P]=s.useState(null),M=s.useCallback(async()=>{if(o){y(!0),k(null),m([]);try{const i=await Ne(o);m(i)}catch(i){console.error("İstifadəçi şərhlərini gətirmə xətası:",i),k(i.message||"İstifadəçinin şərhləri gətirilərkən xəta baş verdi.")}finally{y(!1)}}},[o]);s.useEffect(()=>{u&&o&&M(),u||(m([]),k(null),y(!1))},[u,o,M]);const N=i=>{P(i),U(!0)},E=async()=>{if(l){j(l.id);try{await Ye(l.id),Te("Şərh uğurla silindi."),m(i=>i.filter(g=>g.id!==l.id)),U(!1),P(null)}catch(i){Ue(i.message||"Şərh silinərkən xəta baş verdi.")}finally{j(null)}}},C=i=>{try{return Fe(new Date(i),{addSuffix:!0,locale:Qe})}catch{return i}},F=i=>{const g=zt[i]||{label:i,icon:null,color:"default"};return e.jsx(z,{title:`Status: ${g.label}`,children:e.jsx(Y,{icon:g.icon,label:g.label,size:"small",color:g.color,variant:"outlined",sx:{ml:1.5,opacity:.85,fontSize:"0.75rem",height:"22px"}})})};return e.jsxs(X,{open:u,onClose:a,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{borderRadius:2,height:"85vh"}},children:[e.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1,borderBottom:`1px solid ${r.palette.divider}`},children:[e.jsxs(W,{variant:"h6",component:"span",children:[e.jsx(ae,{sx:{verticalAlign:"bottom",mr:1,opacity:.8}}),e.jsx("strong",{children:p||"İstifadəçi"})," Şərhləri"]}),e.jsx(I,{onClick:a,size:"small",children:e.jsx(ve,{})})]}),e.jsx(K,{dividers:!0,sx:{bgcolor:q(r.palette.action.hover,.2),p:0},children:d?e.jsx(B,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",py:5},children:e.jsx(T,{})}):_?e.jsx(R,{severity:"error",sx:{m:2},children:_}):c.length===0?e.jsx(R,{severity:"info",sx:{m:2},children:"Bu istifadəçinin heç bir şərhi yoxdur."}):e.jsx(Me,{disablePadding:!0,children:c.map(i=>e.jsx(Ee,{alignItems:"flex-start",secondaryAction:e.jsx(z,{title:"Şərhi sil",children:e.jsx(I,{edge:"end","aria-label":"sil",onClick:()=>N(i),disabled:S===i.id,size:"small",children:S===i.id?e.jsx(T,{size:20}):e.jsx(ge,{fontSize:"small",color:"error"})})}),sx:{py:2,px:2.5,borderBottom:`1px solid ${r.palette.divider}`},children:e.jsx(Ie,{primary:e.jsx(W,{variant:"body2",sx:{mb:1},children:i.content}),secondary:e.jsxs(B,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:.5,mt:.5},children:[e.jsx(z,{title:"Film",children:e.jsxs(Xe,{component:Re,to:`/movie/${i.movie_imdb_id}`,target:"_blank",underline:"hover",color:"text.secondary",sx:{display:"inline-flex",alignItems:"center",mr:1},children:[e.jsx(Be,{sx:{fontSize:"1rem",mr:.5,opacity:.7}}),i.movieTitle||i.movie_imdb_id,e.jsx(He,{sx:{fontSize:"0.8rem",ml:.5,opacity:.7}})]})}),e.jsx(z,{title:"Tarix",children:e.jsxs(W,{component:"span",variant:"caption",color:"text.secondary",sx:{display:"inline-flex",alignItems:"center"},children:[e.jsx(be,{sx:{fontSize:"1rem",mr:.5,opacity:.7}}),C(i.created_at)]})}),F(i.status)]})})},i.id))})}),e.jsx(Z,{sx:{borderTop:`1px solid ${r.palette.divider}`},children:e.jsx(w,{onClick:a,children:"Bağla"})}),e.jsx(Ge,{open:v,onClose:()=>U(!1),onConfirm:E,title:"Şərh Silmə Təsdiqi",message:e.jsxs(e.Fragment,{children:["Seçilmiş şərhi (",l==null?void 0:l.id,") silmək istədiyinizə əminsinizmi?",e.jsx("br",{}),e.jsxs(W,{variant:"caption",color:"text.secondary",children:['"',e.jsxs("i",{children:[l==null?void 0:l.content.substring(0,50),l!=null&&l.content&&l.content.length>50?"...":""]}),'"']}),e.jsx("br",{}),"Bu əməliyyat geri alına bilməz."]}),confirmText:"Bəli, Sil",cancelText:"Xeyr, Ləğv Et",isLoading:!!S,confirmButtonColor:"error"})]})},Dt=({open:u,user:a,onClose:o,onSave:p,isSaving:r})=>{const[c,m]=s.useState(""),[d,y]=s.useState(""),_=V(),k=he(_.breakpoints.down("sm"));s.useEffect(()=>{a&&(m(a.username||""),y(a.email||""))},[a]);const S=j=>{if(j.preventDefault(),!a)return;const v={};if(c&&c!==a.username&&(v.username=c),d&&d!==a.email&&(v.email=d),Object.keys(v).length===0){o();return}p(a.id,v)};return e.jsxs(X,{open:u,onClose:o,fullScreen:k,PaperProps:{sx:{borderRadius:{xs:0,sm:2},width:{sm:"450px"},maxWidth:"100%"}},children:[e.jsx(J,{sx:{bgcolor:q(_.palette.secondary.main,.1),pb:1},children:"İstifadəçini Redaktə Et"}),e.jsxs("form",{onSubmit:S,children:[e.jsx(K,{sx:{pt:3},children:e.jsxs(fe,{spacing:3,children:[e.jsx(xe,{label:"İstifadəçi adı",fullWidth:!0,value:c,onChange:j=>m(j.target.value),autoFocus:!0,InputLabelProps:{shrink:!0},disabled:r}),e.jsx(xe,{label:"E-poçt",type:"email",fullWidth:!0,value:d,onChange:j=>y(j.target.value),InputLabelProps:{shrink:!0},disabled:r})]})}),e.jsxs(Z,{sx:{px:3,pb:3},children:[e.jsx(w,{onClick:o,color:"inherit",disabled:r,variant:"outlined",children:"Ləğv et"}),e.jsx(w,{type:"submit",color:"secondary",variant:"contained",disabled:r,sx:{minWidth:"100px"},children:r?e.jsx(T,{size:20,color:"inherit"}):"Saxla"})]})]})]})},kt=({open:u,user:a,onClose:o,onConfirm:p,isDeleting:r})=>{const c=V(),m=he(c.breakpoints.down("sm"));return e.jsxs(X,{open:u,onClose:o,fullScreen:m,PaperProps:{sx:{borderRadius:{xs:0,sm:2},width:{sm:"450px"},maxWidth:"100%"}},children:[e.jsx(J,{sx:{bgcolor:q(c.palette.error.main,.1),pb:1,color:c.palette.error.main},children:"İstifadəçini Sil"}),e.jsx(K,{sx:{pt:3},children:e.jsxs(tt,{children:[e.jsx("strong",{children:a==null?void 0:a.username})," istifadəçisini silmək istədiyinizə əminsiniz? Bu əməliyyat geri qaytarıla bilməz və istifadəçinin bütün məlumatları silinəcək."]})}),e.jsxs(Z,{sx:{px:3,pb:3},children:[e.jsx(w,{onClick:o,color:"inherit",disabled:r,variant:"outlined",children:"Ləğv et"}),e.jsx(w,{onClick:()=>a&&p(a.id),color:"error",variant:"contained",disabled:r,sx:{minWidth:"100px"},children:r?e.jsx(T,{size:20,color:"inherit"}):"Sil"})]})]})},Qt=()=>{const{username:u}=Pe(),a=V(),[o,p]=s.useState([]),[r,c]=s.useState(!0),[m,d]=s.useState(null),[y,_]=s.useState(null),[k,S]=s.useState(null),[j,v]=s.useState(!1),[U,l]=s.useState(!1),[P,M]=s.useState(null),[N,E]=s.useState(!1),[C,F]=s.useState(null),[i,g]=s.useState(!1),[A,O]=s.useState(null),de=s.useCallback(async()=>{var t,h;c(!0),d(null);try{const x=await H.getAllUsers();p(x)}catch(x){console.error("İstifadəçi siyahısı alınarkən xəta:",x);const f=((h=(t=x.response)==null?void 0:t.data)==null?void 0:h.error)||x.message||"İstifadəçi siyahısı alınamadı.";d(f),p([])}finally{c(!1)}},[]);s.useEffect(()=>{de()},[de]),s.useEffect(()=>{if(A){const t=setTimeout(()=>{O(null)},5e3);return()=>clearTimeout(t)}},[A]);const _e=async(t,h)=>{var x,f;_(t),d(null);try{await H.setUserAdminStatus(t,!h),p(b=>b.map(L=>L.id===t?{...L,is_admin:!h}:L)),O(`İstifadəçinin admin statusu ${h?"alındı":"verildi"}.`)}catch(b){console.error(`Admin statusu dəyişdirilərkən xəta (ID: ${t}):`,b),d(((f=(x=b.response)==null?void 0:x.data)==null?void 0:f.error)||"Admin statusu yenilənərkən xəta baş verdi.")}finally{_(null)}},Se=t=>{S(t),v(!0)},Ce=async(t,h)=>{var x,f;l(!0),d(null);try{const b=await H.updateUser(t,h);p(L=>L.map(Q=>Q.id===t?{...Q,...h}:Q)),O("İstifadəçi məlumatları uğurla yeniləndi."),l(!1),v(!1),S(null)}catch(b){console.error(`İstifadəçi məlumatları yenilənərkən xəta (ID: ${t}):`,b),d(((f=(x=b.response)==null?void 0:x.data)==null?void 0:f.error)||"İstifadəçi məlumatları yenilənərkən xəta baş verdi."),l(!1)}},ze=t=>{M(t),E(!1)},$e=async t=>{var h,x;E(!0),d(null);try{await H.deleteUser(t),p(f=>f.filter(b=>b.id!==t)),O("İstifadəçi uğurla silindi."),E(!1),M(null)}catch(f){console.error(`İstifadəçi silinərkən xəta (ID: ${t}):`,f),d(((x=(h=f.response)==null?void 0:h.data)==null?void 0:x.error)||"İstifadəçi silinərkən xəta baş verdi."),E(!1)}},De=t=>{F(t),g(!0)},ke=()=>r?e.jsx(B,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:5},children:e.jsx(T,{})}):m?e.jsx(R,{severity:"error",sx:{mt:2},children:m}):o.length===0?e.jsx(R,{severity:"info",sx:{mt:2},children:"Heç bir istifadəçi tapılmadı."}):e.jsx(Je,{component:Le,elevation:2,sx:{mt:2},children:e.jsxs(Ke,{sx:{minWidth:750},"aria-label":"istifadəçilər cədvəli",children:[e.jsx(Ze,{sx:{backgroundColor:q(a.palette.secondary.main,.1)},children:e.jsxs(me,{children:[e.jsx(n,{sx:{fontWeight:"bold"},children:"ID"}),e.jsx(n,{sx:{fontWeight:"bold"},children:"Avatar"}),e.jsx(n,{sx:{fontWeight:"bold"},children:"İstifadəçi adı"}),e.jsx(n,{sx:{fontWeight:"bold"},children:"E-poçt"}),e.jsx(n,{sx:{fontWeight:"bold"},children:"Status"}),e.jsx(n,{sx:{fontWeight:"bold"},children:"Qoşulma Tarixi"}),e.jsx(n,{align:"center",sx:{fontWeight:"bold"},children:"Şərhlər"}),e.jsx(n,{align:"center",sx:{fontWeight:"bold"},children:"Əməliyyatlar"})]})}),e.jsx(et,{children:o.map(t=>e.jsxs(me,{sx:{"&:last-child td, &:last-child th":{border:0}},hover:!0,children:[e.jsx(n,{component:"th",scope:"row",children:t.id}),e.jsx(n,{children:e.jsx(we,{src:t.avatar_url||void 0,alt:t.username,sx:{width:36,height:36},children:!t.avatar_url&&e.jsx(ce,{})})}),e.jsx(n,{sx:{fontWeight:"medium"},children:t.username}),e.jsx(n,{children:t.email||"-"}),e.jsx(n,{children:t.is_admin?e.jsx(Y,{icon:e.jsx(G,{}),label:"Admin",color:"secondary",size:"small",variant:"outlined"}):e.jsx(Y,{icon:e.jsx(ce,{}),label:"İstifadəçi",size:"small",variant:"outlined"})}),e.jsx(n,{children:We(t.created_at)}),e.jsx(n,{align:"center",children:e.jsx(z,{title:`${t.username} adlı istifadəçinin şərhlərinə bax`,children:e.jsx(Ae,{badgeContent:t.comment_count||0,color:"info",invisible:!t.comment_count||t.comment_count===0,sx:{"& .MuiBadge-badge":{fontSize:"0.7rem",height:16,minWidth:16}},children:e.jsx(I,{size:"small",onClick:()=>De(t),color:"info",children:e.jsx(ae,{fontSize:"small"})})})})}),e.jsx(n,{align:"center",children:e.jsxs(fe,{direction:"row",spacing:.5,justifyContent:"center",children:[e.jsx(z,{title:t.is_admin?"Admin Yetkisini Al":"Admin Yetkisi Ver",children:e.jsx("span",{children:e.jsx(I,{color:t.is_admin?"error":"secondary",onClick:()=>_e(t.id,t.is_admin),disabled:r||y===t.id||t.username===u,size:"small",children:y===t.id?e.jsx(T,{size:20,color:"inherit"}):t.is_admin?e.jsx(pe,{}):e.jsx(G,{})})})}),e.jsx(z,{title:"Düzənlə",children:e.jsx("span",{children:e.jsx(I,{color:"primary",onClick:()=>Se(t),disabled:r||t.username===u,size:"small",children:e.jsx(je,{})})})}),e.jsx(z,{title:"Sil",children:e.jsx("span",{children:e.jsx(I,{color:"error",onClick:()=>ze(t),disabled:r||t.username===u,size:"small",children:e.jsx(Oe,{})})})})]})})]},t.id))})]})});return e.jsxs(B,{sx:{p:{xs:2,sm:3}},children:[m&&e.jsx(R,{severity:"error",sx:{mb:3},children:m}),A&&e.jsx(R,{severity:"success",sx:{mb:3},children:A}),ke(),e.jsx(Dt,{open:j,user:k,onClose:()=>v(!1),onSave:Ce,isSaving:U}),e.jsx(kt,{open:!!P,user:P,onClose:()=>M(null),onConfirm:$e,isDeleting:N}),e.jsx($t,{open:i,userId:(C==null?void 0:C.id)??null,username:(C==null?void 0:C.username)??null,onClose:()=>g(!1)})]})};export{Qt as default};
