import{ag as w,j as e,u as re,r as n,T as o,L as G,B as u,a6 as Y,c as L,C as N,af as me,i as ie,s as U,a as ne,am as ae,a4 as xe,v as H,I as W,k as ue,d as he,b as ee,an as pe,P as se,D as E}from"./index-BpWeeXno.js";import{c as fe,f as je,l as ge,v as be,d as ye,e as ve}from"./commentService-B5sfTTRX.js";import{L as le}from"./Link-TyrU6qHP.js";import{T as ke}from"./TextField-dzW9UA8F.js";import{C as Ce}from"./ConfirmationDialog-cnNKTUQX.js";import{A as V}from"./ArrowBack-DmMnYd99.js";import{G as $}from"./Grid-BYpl_fwb.js";import{C as ze}from"./CardMedia-DY3-Nlai.js";import{C as O}from"./Chip-B6pTYDXi.js";import{C as De}from"./CalendarToday-CrFuFleB.js";import"./DialogTitle-D_8HmEPp.js";import"./DialogContentText-BMt4y1nX.js";import"./DialogActions-Dny6v2BL.js";const Ae=w([e.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),e.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime"),we=w(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline"),Se=w(e.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"ErrorOutline"),Te=w(e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"}),"Reply"),Le=w(e.jsx("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Me=w(e.jsx("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2m4 0v12h4V3z"}),"ThumbDown"),Ie=w(e.jsx("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2m0 12-4.34 4.34L12 14H3v-2l3-7h9zm4-12h4v12h-4z"}),"ThumbDownOutlined"),Re=w(e.jsx("path",{d:"M1 21h4V9H1zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73z"}),"ThumbUp"),_e=w(e.jsx("path",{d:"M9 21h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.58 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2M9 9l4.34-4.34L12 10h9v2l-3 7H9zM1 9h4v12H1z"}),"ThumbUpOutlined"),te={"movie-poster":"_movie-poster_xef9j_3","genre-chip":"_genre-chip_xef9j_13"},oe=({movieId:t,parentId:g=null,onCommentAdded:m,placeholder:s="Şərhinizi yazın...",buttonText:k="Göndər",variant:l="filled",showCancelButton:p=!1,onCancel:h})=>{const{isLoggedIn:c}=re(),[D,A]=n.useState(""),[b,v]=n.useState(!1),[i,x]=n.useState(null),j=async d=>{var T,r;if(d.preventDefault(),!D.trim()||!c)return;v(!0),x(null);const S={content:D,movieId:t,parentId:g};try{await fe(S),g?me("Cavabınız təsdiq üçün göndərildi."):ie("Şərhiniz təsdiq üçün göndərildi və admin tərəfindən yoxlanılır!"),A(""),x(null),m&&m(),p&&h&&h()}catch(a){console.error("Yorum gönderme hatası:",a);let f="Şərh göndərilərkən xəta baş verdi.";typeof a=="string"?f=a:(r=(T=a==null?void 0:a.response)==null?void 0:T.data)!=null&&r.error?f=a.response.data.error:a!=null&&a.message&&(f=a.message),f.includes("uuid")&&(f="Sistem xətası: Texniki dəstəklə əlaqə saxlayın."),x(f),U(f)}finally{v(!1)}};return c?e.jsxs(u,{component:"form",onSubmit:j,sx:{mt:g?1:2},children:[e.jsx(ke,{fullWidth:!0,multiline:!0,rows:g?2:3,variant:l,label:s,value:D,onChange:d=>A(d.target.value),disabled:b,required:!0,sx:{mb:1,bgcolor:l==="filled"?"action.hover":void 0},InputProps:{disableUnderline:l==="filled"}}),i&&e.jsx(Y,{severity:"error",sx:{mb:1},children:i}),e.jsxs(u,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[p&&e.jsx(L,{variant:"text",onClick:h,disabled:b,size:"small",children:"Ləğv et"}),e.jsx(L,{type:"submit",variant:"contained",disabled:b||!D.trim(),size:"small",startIcon:b?e.jsx(N,{size:16,color:"inherit"}):null,children:k})]})]}):e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Şərh yazmaq üçün ",e.jsx(le,{component:G,to:"/login",children:"daxil olun"}),"."]})},Be=({comment:t,movieId:g,onVoteChange:m,onReplyAdded:s,onDelete:k,level:l=0})=>{var q,K,Q,X,J,Z;const{isLoggedIn:p,isAdmin:h,userId:c}=re(),D=ne(),[A,b]=n.useState(!1),[v,i]=n.useState(!1),[x,j]=n.useState(!1),[d,S]=ae.useState(null),[T,r]=n.useState(!1),a=y=>{try{return je(new Date(y),{addSuffix:!0,locale:ge})}catch(M){return console.error("Date formatting error:",M),y}},f=c!==null&&c===t.user_id,R=async y=>{if(!p||v||f)return;i(!0);const M=t.likes,F=t.dislikes,I=t.user_vote;let _=M,B=F,P=null;I===y?(P=null,y==="like"?_--:B--):(P=y,y==="like"?(_++,I==="dislike"&&B--):(B++,I==="like"&&_--)),m(t.id,_,B,P);try{const z=await be(t.id,{voteType:y});if(z&&typeof z.likes=="number"&&typeof z.dislikes=="number"){const de=z.user_vote;m(t.id,z.likes,z.dislikes,de)}else console.warn("Backend'den səs məlumatları düzgün formatda gəlmədi."),m(t.id,M,F,I??null)}catch(z){U((z==null?void 0:z.message)||"Oy verərkən xəta baş verdi."),m(t.id,M,F,I??null)}finally{i(!1)}},C=()=>{r(!0)},ce=async()=>{if(!(!h||x)){j(!0);try{await ye(t.id),ie("Şərh silindi."),r(!1),k(t.id)}catch(y){U((y==null?void 0:y.message)||"Şərh silinərkən xəta baş verdi."),r(!1)}finally{j(!1)}}};return e.jsxs(u,{sx:{display:"flex",gap:2,py:2,px:l>0?1:0,ml:l*(l>1?3:4),borderLeft:l>0?`2px solid ${D.palette.divider}`:"none",pl:l>0?2:0,position:"relative"},children:[e.jsx(xe,{component:G,to:`/user/username/${(q=t.author)==null?void 0:q.username}`,src:((K=t.author)==null?void 0:K.avatar_url)||"",alt:((Q=t.author)==null?void 0:Q.username)||"Anonim",sx:{width:36,height:36,mt:.5}}),e.jsxs(u,{sx:{flexGrow:1},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsx(le,{component:G,to:`/user/username/${(X=t.author)==null?void 0:X.username}`,underline:"hover",color:"primary.main",sx:{fontWeight:"medium",mr:1,fontSize:"0.9rem"},children:((J=t.author)==null?void 0:J.username)||"Anonim"}),e.jsx(o,{variant:"caption",color:"text.secondary",children:a(t.created_at)}),h&&e.jsx(H,{title:"Şərhi sil",arrow:!0,children:e.jsx(W,{size:"small",onClick:C,disabled:x,sx:{ml:"auto"},color:"error",children:x?e.jsx(N,{size:16,color:"inherit"}):e.jsx(we,{fontSize:"small"})})})]}),e.jsx(o,{variant:"body2",sx:{mb:1},children:t.content}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(H,{title:f?"Öz şərhinizə səs verə bilməzsiniz":"Bəyən",arrow:!0,placement:"top",children:e.jsx("span",{children:e.jsx(W,{size:"small",onClick:()=>R("like"),disabled:!p||v||f,color:t.user_vote==="like"?"primary":"default",children:t.user_vote==="like"?e.jsx(Re,{fontSize:"small"}):e.jsx(_e,{fontSize:"small"})})})}),e.jsx(o,{variant:"caption",sx:{fontWeight:500,minWidth:"1.5em"},children:t.likes}),e.jsx(H,{title:f?"Öz şərhinizə səs verə bilməzsiniz":"Bəyənmə",arrow:!0,placement:"top",children:e.jsx("span",{children:e.jsx(W,{size:"small",onClick:()=>R("dislike"),disabled:!p||v||f,color:t.user_vote==="dislike"?"error":"default",children:t.user_vote==="dislike"?e.jsx(Me,{fontSize:"small"}):e.jsx(Ie,{fontSize:"small"})})})}),e.jsx(o,{variant:"caption",sx:{fontWeight:500,minWidth:"1.5em"},children:t.dislikes}),l<3&&p&&e.jsx(L,{size:"small",startIcon:e.jsx(Te,{fontSize:"small"}),onClick:()=>b(!A),sx:{ml:1,textTransform:"none"},children:A?"Ləğv et":"Cavabla"})]}),A&&e.jsx(oe,{movieId:g,parentId:t.id,onCommentAdded:()=>{b(!1),s()},placeholder:`${((Z=t.author)==null?void 0:Z.username)||"Anonim"} adlı istifadəçiyə cavab ver...`,buttonText:"Cavab Göndər",variant:"standard",showCancelButton:!0,onCancel:()=>b(!1)})]}),e.jsx(Ce,{open:T,onClose:()=>r(!1),onConfirm:ce,title:"Şərh Silmə Təsdiqi",message:e.jsxs(e.Fragment,{children:["Bu şərhi silmək istədiyinizə əminsinizmi? ",e.jsx("br",{}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:['"',e.jsxs("i",{children:[t.content.substring(0,50),t.content.length>50?"...":""]}),'"']})," ",e.jsx("br",{}),"Bu əməliyyat geri alına bilməz."]}),confirmText:"Bəli, Sil",cancelText:"Xeyr, Ləğv Et",isLoading:x,confirmButtonColor:"error"})]})},Ee={"comment-list-container":"_comment-list-container_1a0h2_3"},Oe=({movieId:t,refreshKey:g})=>{const[m,s]=n.useState([]),[k,l]=n.useState(!0),[p,h]=n.useState(null),c=n.useCallback(async()=>{l(!0),h(null);try{const i=await ve(t);s(i)}catch(i){h((i==null?void 0:i.message)||"Şərhlər yüklənərkən xəta baş verdi.")}finally{l(!1)}},[t]);n.useEffect(()=>{c()},[c,g]);const D=n.useCallback((i,x,j,d)=>{s(S=>S.map(r=>r.id===i?{...r,likes:x,dislikes:j,user_vote:d}:r))},[]),A=n.useCallback(i=>{s(x=>x.filter(j=>j.id!==i))},[]),b=n.useCallback(()=>{c()},[c]),v=(i,x=null,j=0)=>i.filter(d=>d.parent_comment_id===x).sort((d,S)=>new Date(S.created_at).getTime()-new Date(d.created_at).getTime()).map(d=>e.jsxs(ae.Fragment,{children:[e.jsx(Be,{comment:d,movieId:t,onVoteChange:D,onReplyAdded:b,onDelete:A,level:j}),v(i,d.id,j+1)]},d.id));return k?e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"center",p:3},children:[e.jsx(N,{size:24,sx:{mr:1}}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Şərhlər yüklənir..."})]}):p?e.jsxs(Y,{severity:"warning",sx:{mt:2},children:[p,e.jsx(L,{size:"small",onClick:c,sx:{ml:1},children:"Yenidən cəhd et"})]}):e.jsx(u,{className:Ee["comment-list-container"],sx:{mt:0},children:m.length===0?e.jsx(o,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:3},children:"Hələ heç bir şərh yoxdur."}):v(m)})},Xe=()=>{const{movieId:t}=ue(),g=ne(),m=he(g.breakpoints.down("sm")),[s,k]=n.useState(null),[l,p]=n.useState(!0),[h,c]=n.useState(null),[D,A]=n.useState(""),[b,v]=n.useState(0);n.useEffect(()=>{let r=!0;return(async()=>{if(!t){r&&(c("Film ID tapılmadı."),p(!1));return}const R=`https://www.omdbapi.com/?i=${t}&apikey=b567a8f1&plot=full`;r&&(p(!0),c(null),k(null));try{const C=await pe.get(R);C.data&&C.data.Response==="True"?r&&(k(C.data),c(null)):(console.error("OMDb API xətası:",C.data.Error),c(C.data.Error||"Film tapılmadı və ya API xətası."),k(null))}catch(C){console.error("OMDb API çağırışı zamanı xəta:",C),r&&(c(C.message||"Film detalları yüklənərkən bir xəta baş verdi."),k(null))}finally{r&&p(!1)}})(),()=>{r=!1}},[t]);const i=()=>{window.history.back()},x=()=>{v(r=>r+1)},j=()=>e.jsxs(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"70vh"},children:[e.jsx(N,{}),e.jsx(o,{sx:{ml:2},children:"Film Detalları Yüklənir..."})]}),d=()=>e.jsxs(ee,{maxWidth:"sm",sx:{mt:4,textAlign:"center"},children:[e.jsx(Y,{severity:"error",icon:e.jsx(Se,{}),variant:"outlined",sx:{mb:2,justifyContent:"center"},children:h||"Bilinməyən bir xəta baş verdi."}),e.jsx(L,{variant:"outlined",startIcon:e.jsx(V,{}),onClick:i,children:"Geri Qayıt"})]}),S=()=>{if(!s||s.Response!=="True")return!l&&!h?(c("Film məlumatları düzgün formatda deyil."),d()):null;const r=typeof s.Genre=="string"?s.Genre.split(",").map(a=>a.trim()):[];return e.jsxs(se,{elevation:m?0:3,sx:{p:{xs:2,sm:3,md:4},mt:2,bgcolor:"background.paper",borderRadius:m?0:2},children:[e.jsx(L,{startIcon:e.jsx(V,{}),onClick:i,sx:{mb:2,display:{xs:"none",sm:"inline-flex"}},children:"Geri"}),e.jsxs($,{container:!0,spacing:{xs:3,md:4},children:[e.jsx($,{item:!0,xs:12,sm:4,md:3,sx:{textAlign:"center"},children:e.jsx(ze,{component:"img",image:s.Poster!=="N/A"?s.Poster:"/placeholder-image.png",alt:`${s.Title} posteri`,className:te["movie-poster"],sx:{borderRadius:2,width:"100%",maxWidth:{xs:"200px",sm:"100%"},height:"auto",objectFit:"cover",mb:2,boxShadow:`0 4px 12px ${g.palette.mode==="dark"?"rgba(0,0,0,0.4)":"rgba(0,0,0,0.15)"}`,display:"inline-block"}})}),e.jsxs($,{item:!0,xs:12,sm:8,md:9,children:[e.jsx(o,{variant:m?"h5":"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:s.Title||"Başlıq Yoxdur"}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:{xs:1,sm:1.5},mb:2.5},children:[s.Year&&s.Year!=="N/A"&&e.jsx(O,{icon:e.jsx(De,{}),label:s.Year,variant:"outlined",size:"small"}),s.Runtime&&s.Runtime!=="N/A"&&e.jsx(O,{icon:e.jsx(Ae,{}),label:s.Runtime,variant:"outlined",size:"small"}),s.imdbRating&&s.imdbRating!=="N/A"&&e.jsx(O,{icon:e.jsx(Le,{sx:{color:"#f5c518"}}),label:`IMDb: ${s.imdbRating}`,variant:"outlined",size:"small"})]}),r.length>0&&r[0]!=="N/A"&&e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.8,mb:3},children:r.map(a=>e.jsx(O,{label:a,size:"small",className:te["genre-chip"],sx:{bgcolor:g.palette.mode==="dark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.08)",color:"text.secondary",fontWeight:500}},a))}),e.jsx(E,{sx:{mb:2.5}}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Məzmun"}),e.jsx(o,{variant:"body1",paragraph:!0,sx:{color:"text.secondary"},children:s.Plot&&s.Plot!=="N/A"?s.Plot:"Məzmun məlumatı mövcud deyil."}),(s.Director&&s.Director!=="N/A"||s.Actors&&s.Actors!=="N/A")&&e.jsx(E,{sx:{my:3}}),s.Director&&s.Director!=="N/A"&&e.jsxs(u,{sx:{mb:1.5},children:[e.jsx(o,{variant:"overline",display:"block",color:"text.secondary",children:"Rejissor"}),e.jsx(o,{variant:"body2",children:s.Director})]}),s.Actors&&s.Actors!=="N/A"&&e.jsxs(u,{children:[e.jsx(o,{variant:"overline",display:"block",color:"text.secondary",children:"Aktyorlar"}),e.jsx(o,{variant:"body2",children:s.Actors})]})]})]})]})},T=()=>!s||s.Response!=="True"||!t?null:e.jsxs(se,{elevation:m?0:3,sx:{p:{xs:2,sm:3},mt:3,bgcolor:"background.paper",borderRadius:m?0:2},children:[e.jsx(o,{variant:"h6",component:"h2",gutterBottom:!0,children:"Şərhlər"}),e.jsx(E,{sx:{mb:2}}),e.jsxs(u,{sx:{mb:3},children:[e.jsx(o,{variant:"subtitle1",component:"h3",gutterBottom:!0,sx:{fontWeight:"medium"},children:"Şərhinizi Bildirin"}),e.jsx(oe,{movieId:t,onCommentAdded:x})]}),e.jsx(E,{sx:{mb:2}}),e.jsx(Oe,{movieId:t,refreshKey:b})]});return e.jsxs(ee,{maxWidth:"lg",sx:{mt:{xs:0,sm:2},mb:4},children:[e.jsxs(u,{sx:{display:{xs:"flex",sm:"none"},alignItems:"center",p:1.5,bgcolor:"background.paper"},children:[e.jsx(W,{onClick:i,size:"small",sx:{mr:1},children:e.jsx(V,{})}),e.jsx(o,{variant:"h6",noWrap:!0,children:l?"Yüklənir...":(s==null?void 0:s.Title)||"Film Detalları"})]}),l&&j(),h&&d(),!l&&!h&&s&&e.jsxs(u,{children:[S(),T()]}),!l&&!h&&!s&&d()]})};export{Xe as default};
